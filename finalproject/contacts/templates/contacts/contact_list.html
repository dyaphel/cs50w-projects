{% extends "contacts/layout.html" %}

{% load static %}

{% block title %}Contacts{% endblock %}

{% block head %}
<link href="{% static 'contacts/contactlist.css' %}" rel="stylesheet">
{% endblock %}

{% block body %}
<div class="header-section">
    <div class="profile-icons">
        <button id="deleteButton" disabled onclick="deleteSelectedContacts()">
            <img src="{% static 'img/delete.png' %} " class="icon" alt="Delete">
            {% csrf_token %}
        </button>
        <button id="selectButton" onclick="toggleCheckboxes()">
            <img src="{% static 'img/select.png' %}" class="icon" alt="Save">
        </button>
        <button id="addButton" onclick="window.location.href='{% url 'add_contact' %}'">
            <img src="{% static 'img/add.png' %}" class="icon" alt="Add">
        </button>
    </div>
</div>

    {% for contact in contacts %}
    <div class="profile-container">
        <input type="checkbox" class="checkbox" hidden data-contact-id="{{ contact.id }}" onchange="updateDeleteButton()">

        <div class="profile-picture">
            {{ contact.name.0|upper }}{{ contact.surname.0|upper }}
        </div>
     <div class="user-info">
        <div class="name-row">
            <span id="firstName">{{ contact.name }}</span>
            &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp 
            <span id="lastName">{{ contact.surname }}</span>
            &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp 
            <span id="nickname">{{ contact.nickname }}</span>
        </div>
     </div>
    </div>    
    {% endfor %}
{% endblock %}


{% block script %}
<script>
    function toggleCheckboxes() {
        const checkboxes = document.querySelectorAll('.checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.hidden = !checkbox.hidden;
            checkbox.checked = false; // Reset checkboxes when toggling
        });
        updateDeleteButton(); // Update button status on toggle
    }

    function updateDeleteButton() {
        const checkboxes = document.querySelectorAll('.checkbox');
        const deleteButton = document.getElementById('deleteButton');
        
        // Enable delete button if at least one checkbox is checked
        deleteButton.disabled = !Array.from(checkboxes).some(checkbox => checkbox.checked);
    }

    function deleteSelectedContacts() {
        const selectedContacts = [];
        
        document.querySelectorAll('.checkbox:checked').forEach(checkbox => {
            selectedContacts.push(checkbox.getAttribute('data-contact-id'));
        });

        if (selectedContacts.length > 0) {
            fetch("{% url 'delete_contacts' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken":  document.querySelector('[name=csrfmiddlewaretoken]').value,
                },
                body: JSON.stringify({ contacts: selectedContacts })
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                console.error("Failed to save profile:", response.error);
                alert("Failed to save profile: " + response.error);
            } else {
                window.location.reload();
                console.log("Profile saved successfully");
            }
            })
            .catch(error => console.error("Error:", error));
        }
    }
</script>
{% endblock %}


