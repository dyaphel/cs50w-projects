<meta name="csrf-token" content="{{ csrf_token }}">


<div class="card border-info mb-3">
    <div class="card-header border-info">
        {% if show_username %}
        <a style="color: black;" href="{% url 'profile' post.user.username %}">{{ post.user.username }}</a>
        {% else %}
        <p style="color: grey; font-size: medium; margin-bottom: -2px;">{{ post.date }}</p>
        {% endif %}
    </div>
    <div class="card-body">
        <h5 class="card-title" id="post-content-{{ post.id }}" >{{ post.body }}</h5>
        {% if show_username %}
        <p class="card-text">{{ post.date }}</p>
        {%endif%}
         <!-- Hidden textarea for editing the post -->
         <textarea class="edit-area" id="edit-post-{{ post.id }}">{{ post.body }}</textarea>
    </div>
    <div class="card-footer border-info">
        Like: {{ post.like }}
        {% if request.user == post.user %}
        <button class="edit-btn" data-post-id="{{ post.id }}" style="background-color: transparent; border-color: transparent; float: right;">
            <img src="../../static/network/pen-fill.svg">
        </button>
        <button class="save-btn" id="save-btn-{{ post.id }}" >Save
            {% csrf_token %}
        </button>
        {% endif %}
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.edit-btn').forEach(button => {
        button.onclick = function() {
            const postId = this.dataset.postId;
            const postContent = document.getElementById(`post-content-${postId}`);
            const editArea = document.getElementById(`edit-post-${postId}`);
            const editButton = this;
            const saveButton = document.getElementById(`save-btn-${postId}`);

            // Hide the edit button, show the textarea and save button
            editButton.style.display = 'none';
            editArea.style.display = 'block';
            postContent.style.display = 'none';
            saveButton.style.display = 'block';

            // On clicking the save button
            saveButton.onclick = function() {
                const newContent = editArea.value;

                // Send the new content to the server via AJAX
                fetch(`/edit-post/${postId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: JSON.stringify({
                        body: newContent
                    })
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        // Update the post content and reset the view
                        postContent.innerHTML = newContent;
                        editArea.style.display = 'none';
                        saveButton.style.display = 'none';
                        postContent.style.display = 'block';
                        editButton.style.display = 'block';
                    } else {
                        console.error("Failed to update post.");
                    }
                })
                .catch(error => console.error('Error:', error));
            };
        };
    });
});
</script>
